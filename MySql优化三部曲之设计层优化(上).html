<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="DjWo83eqzDI8jDOvqce_4gvpbEzYI_HthXoohEiN4Pk">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/img/dog.jpeg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-dog.jpeg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-dog.jpeg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="SQL优化,索引,分区,分表,三范式,索引的执行计划,索引的数据结构,索引覆盖">










<meta name="description" content="设计层设计层优化有点长，所以我分成了两部分来写！（上） 三范式范式：数据库数据表设计时所遵循的规则，我们称之为范式。">
<meta name="keywords" content="SQL优化,索引,分区,分表,三范式,索引的执行计划,索引的数据结构,索引覆盖">
<meta property="og:type" content="article">
<meta property="og:title" content="MySql优化三部曲之设计层优化(上)">
<meta property="og:url" content="https:blog.guozhenlei.top/MySql优化三部曲之设计层优化(上).html">
<meta property="og:site_name" content="磊大大的个人博客">
<meta property="og:description" content="设计层设计层优化有点长，所以我分成了两部分来写！（上） 三范式范式：数据库数据表设计时所遵循的规则，我们称之为范式。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:/img/WechatIMG1.jpeg">
<meta property="og:image" content="https:/img/WechatIMG2.jpeg">
<meta property="og:image" content="https:/img/WechatIMG3.jpeg">
<meta property="og:image" content="https:/img/WechatIMG20.jpeg">
<meta property="og:image" content="https:/img/WechatIMG21.jpeg">
<meta property="og:image" content="https:/img/WechatIMG22.jpeg">
<meta property="og:image" content="https:/img/WechatIMG23.jpeg">
<meta property="og:image" content="https:/img/WechatIMG24.jpeg">
<meta property="og:image" content="https:/img/WechatIMG25.jpeg">
<meta property="og:image" content="https:/img/WechatIMG9.jpeg">
<meta property="og:image" content="https:/img/WechatIMG10.jpeg">
<meta property="og:image" content="https:/img/WechatIMG.jpeg">
<meta property="og:image" content="https:/img/WechatIMG26.jpeg">
<meta property="og:image" content="https:/img/WechatIMG27.jpeg">
<meta property="og:image" content="https:/img/WechatIMG28.jpeg">
<meta property="og:image" content="https:/img/WechatIMG29.jpeg">
<meta property="og:image" content="https:/img/WechatIMG30.jpeg">
<meta property="og:image" content="https:/img/WechatIMG31.jpeg">
<meta property="og:image" content="https:/img/WechatIMG32.jpeg">
<meta property="og:image" content="https:/img/WechatIMG33.jpeg">
<meta property="og:image" content="https:/img/WechatIMG34.jpeg">
<meta property="og:image" content="https:/img/WechatIMG35.jpeg">
<meta property="og:image" content="https:/img/WechatIMG36.jpeg">
<meta property="og:image" content="https:/img/WechatIMG37.jpeg">
<meta property="og:image" content="https:/img/WechatIMG38.jpeg">
<meta property="og:image" content="https:/img/WechatIMG39.jpeg">
<meta property="og:image" content="https:/img/WechatIMG40.jpeg">
<meta property="og:image" content="https:/img/WechatIMG41.jpeg">
<meta property="og:image" content="https:/img/WechatIMG42.jpeg">
<meta property="og:image" content="https:/img/WechatIMG43.jpeg">
<meta property="og:image" content="https:/img/WechatIMG44.jpeg">
<meta property="og:image" content="https:/img/WechatIMG45.jpeg">
<meta property="og:image" content="https:/img/WechatIMG46.jpeg">
<meta property="og:image" content="https:/img/WechatIMG47.jpeg">
<meta property="og:image" content="https:/img/WechatIMG48.jpeg">
<meta property="og:image" content="https:/img/WechatIMG49.jpeg">
<meta property="og:image" content="https:/img/WechatIMG50.jpeg">
<meta property="og:image" content="https:/img/WechatIMG51.jpeg">
<meta property="og:image" content="https:/img/WechatIMG52.jpeg">
<meta property="og:image" content="https:/img/WechatIMG53.jpeg">
<meta property="og:image" content="https:/img/WechatIMG54.jpeg">
<meta property="og:image" content="https:/img/WechatIMG55.jpeg">
<meta property="og:image" content="https:/img/WechatIMG56.jpeg">
<meta property="og:image" content="https:/img/WechatIMG57.jpeg">
<meta property="og:image" content="https:/img/WechatIMG58.jpeg">
<meta property="og:image" content="https:/img/WechatIMG78.jpeg">
<meta property="og:image" content="https:/img/WechatIMG79.jpeg">
<meta property="og:image" content="https:/img/WechatIMG80.jpeg">
<meta property="og:image" content="https:/img/WechatIMG81.jpeg">
<meta property="og:image" content="https:/img/WechatIMG82.jpeg">
<meta property="og:image" content="https:/img/WechatIMG83.jpeg">
<meta property="og:image" content="https:/img/WechatIMG84.jpeg">
<meta property="og:updated_time" content="2018-07-16T01:02:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySql优化三部曲之设计层优化(上)">
<meta name="twitter:description" content="设计层设计层优化有点长，所以我分成了两部分来写！（上） 三范式范式：数据库数据表设计时所遵循的规则，我们称之为范式。">
<meta name="twitter:image" content="https:/img/WechatIMG1.jpeg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Gzl'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



  <link rel="canonical" href="https:blog.guozhenlei.top/MySql优化三部曲之设计层优化(上).html">





  <title>MySql优化三部曲之设计层优化(上) | 磊大大的个人博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d06a86df5420e1956c374ce450f28878";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">磊大大的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">学习笔记</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https:blog.guozhenlei.top/MySql优化三部曲之设计层优化(上).html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Gzl">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/dog.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="磊大大的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">MySql优化三部曲之设计层优化(上)</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-10T23:32:18+08:00">
                2018-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/MySql/" itemprop="url" rel="index">
                    <span itemprop="name">MySql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/MySql优化三部曲之设计层优化(上).html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="MySql优化三部曲之设计层优化(上).html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="设计层"><a href="#设计层" class="headerlink" title="设计层"></a>设计层</h2><p>设计层优化有点长，所以我分成了两部分来写！（上）</p>
<h2 id="三范式"><a href="#三范式" class="headerlink" title="三范式"></a>三范式</h2><p>范式：数据库数据表设计时所遵循的规则，我们称之为范式。</p>
<a id="more"></a>
<h3 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">我们的表要满足两个条件:</span><br><span class="line">1.表的属性(列)要具有原子性(不可分割)</span><br><span class="line">2.表不能有重复的列,</span><br><span class="line">只要是关系型数据库,就天然的满足第一范式.</span><br><span class="line">关系型数据库:有行和列的概念,即为二维表格,常见的有mysql , sql server, oracle , informix , db2, postgresql</span><br><span class="line">非关系型数据库:面向对象和集合,没有行和列的概念</span><br></pre></td></tr></table></figure>
<h3 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表要满足:不能存在完全相同的两条记录,通常是通过设置一个主键来实现,主键一般是非业务逻辑主键.</span><br></pre></td></tr></table></figure>
<h3 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表中不能存在冗余数据，表中列的值，如果可以通过推导出来，则就不应该设置该列。</span><br></pre></td></tr></table></figure>
<p><code>不满足三范式:</code><br><img src="/img/WechatIMG1.jpeg" alt=""></p>
<p><code>满足三范式:</code><br><img src="/img/WechatIMG2.jpeg" alt=""></p>
<h3 id="反三范式"><a href="#反三范式" class="headerlink" title="反三范式"></a>反三范式</h3><p>有的时候基于性能考虑，需要有意违反 三范式，适度的冗余，以达到提高查询效率的目的。<br>相册浏览次数设计案例<br><img src="/img/WechatIMG3.jpeg" alt=""></p>
<h3 id="查询需要优化的语句"><a href="#查询需要优化的语句" class="headerlink" title="查询需要优化的语句"></a>查询需要优化的语句</h3><p><code>慢查询日志</code><br>是一种<code>mysql</code>提供的日志，记录所有执行时间超过某个时间界限的<code>sql</code>的语句。这个时间界限，<br>我们可以指定。在mysql中默认没有开启慢查询，即使开启了，只会记录执行的<code>sql</code>语句超过<code>10</code>秒的语句。</p>
<h4 id="修改配置启动MySql慢查询日志"><a href="#修改配置启动MySql慢查询日志" class="headerlink" title="修改配置启动MySql慢查询日志"></a>修改配置启动<code>MySql</code>慢查询日志</h4><p>注意：开启慢日志查询时先关闭<code>MySql</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">long_query_time=1</span><br><span class="line">#slow_query_log</span><br><span class="line">slow_query_log=1</span><br><span class="line">##slow_query_log_file=/var/log/mysql-slow-query.log</span><br><span class="line">##以前版本的参数格式跟5.6的不一致</span><br><span class="line">slow_query_log_file=/var/log/mysql-slow-query.log</span><br><span class="line">##将所有没有使用带索引的查询语句全部写到慢查询日志中</span><br><span class="line">log_queries_not_using_indexes=1</span><br><span class="line"></span><br><span class="line">重启`MySql`</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG20.jpeg" alt=""></p>
<h4 id="直接命令开启MySql慢查询日志"><a href="#直接命令开启MySql慢查询日志" class="headerlink" title="直接命令开启MySql慢查询日志"></a>直接命令开启<code>MySql</code>慢查询日志</h4><p>注：5.6之前开启的方式不同，请自行查找！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global slow_query_log=on;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">#查询时间超过0.1秒的sql语句会被记录</span><br><span class="line">mysql&gt; set global long_query_time=0.1;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">#记录慢查询日志的文件地址</span><br><span class="line">mysql&gt; set global slow_query_log_file="/var/lib/mysql/localhost-slow.log";</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line">#记录没有使用索引的查询</span><br><span class="line">mysql&gt; set global log_queries_not_using_indexes=on;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>查看慢查询日志的时间<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'long_query_time'</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG21.jpeg" alt=""></p>
<p>修改慢查询日志的时间<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> long_query_time = <span class="number">0.5</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG22.jpeg" alt=""></p>
<p>注： 这只是测试，还是改回到 <code>1</code> 秒吧！</p>
<p><code>测试查询</code><br>查看慢查询日志<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">benchmark(count,expr)  //函数可以测试执行count次expr操作需要的时间   expr 执行表达式</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG23.jpeg" alt=""><br><img src="/img/WechatIMG24.jpeg" alt=""></p>
<h3 id="精确记录查询时间"><a href="#精确记录查询时间" class="headerlink" title="精确记录查询时间"></a>精确记录查询时间</h3><p>使用<code>mysql</code>提供<code>profile</code>机制完成。<code>profile</code>记录每次执行的具体时间，精确的时间到小数点<code>8</code>位<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">开启`profile`机制:</span><br><span class="line"><span class="keyword">set</span> profiling = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">查看记录`sql`语句的执行时间:</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">profiles</span>;</span><br><span class="line"></span><br><span class="line">注意:不需要分析时,最好将其关闭.</span><br><span class="line"><span class="keyword">set</span> profiling=<span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG25.jpeg" alt=""></p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p><code>索引介绍:</code><br>利用关键字，就是记录的部分数据（某个字段，某些字段，某个字段的一部分），建立与记录位置的对应关系，就是索引。<br>索引的作用：是用于快速定位实际数据位置的一种机制<br>索引在<code>mysql</code>中，是独立于数据的一种特殊的数据结构。<br>索引一定有顺序（排好序的快速查找结构），记录则不一定。<br><code>索引的五种类型:</code><br>主键索引，唯一索引，普通索引，全文索引，复合索引。<br>无论任何类型，都是通过建立关键字与位置的对应的关系来实现的。<br>以上类型的差异，是对关键字的要求不同。<br>关键字：记录的部分数据（某个字段，某些字段，某个字段的一部分）<br>普通索引：对关键字没有要求。<br>唯一索引：要求关键字不能重复，同时增加唯一约束。<br>主键索引：要求关键字不能重复，也不能为<code>NULL</code>。同时增加主键约束。<br>全文索引：关键字的来源不是所有字段的数据，而是从字段中提取的特别关键词。<br>复合索引：关键词的来源是某个字段，也可以是某些字段。是通过在多个字段上提取的关键字。</p>
<h3 id="索引的管理方法"><a href="#索引的管理方法" class="headerlink" title="索引的管理方法"></a>索引的管理方法</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><p><code>创建索引的两种方式:</code><br><code>创建表时创建索引</code><br><img src="/img/WechatIMG9.jpeg" alt=""><br>注意：<br>索引可以起名字，但是主索引不能起名字，因为一个表仅仅可以有一个主键索引，其他索引可以出现多个。名字可以省略，<code>mysql</code>会默认生成，通常使用字段名来充当。</p>
<p><code>更新索引</code><br><img src="/img/WechatIMG10.jpeg" alt=""><br>注意：<br>第一点：如果表中存在数据，数据符合唯一或主键约束才可能创建成功。<br>第二点：<code>auto_increment</code>属性，依赖于一个<code>KEY</code>（主键或唯一）。<br><code>单独创建索引:</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name(col_name); <span class="comment">-- --创建普通索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name(col_name); <span class="comment">-- --创建唯一索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name(col_name_1,col_name_2); <span class="comment">-- --创建普通组合索引</span></span><br><span class="line">UNIQUE INDEX index_name ON table_name(col_name_1,col_name_2); <span class="comment">-- --创建唯一组合索引CREATE</span></span><br></pre></td></tr></table></figure></p>
<h4 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">indexes</span> <span class="keyword">from</span> table_name; <span class="comment">-- --查看索引</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> table_name; <span class="comment">-- --查看索引</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> table_name; <span class="comment">-- --查看生成表的SQL</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">keys</span> <span class="keyword">from</span> table_name; <span class="comment">-- --查看索引</span></span><br><span class="line">desc table_name; <span class="comment">-- --查看数据表结构</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/WechatIMG.jpeg" alt=""></p>
<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><p>修改表结构时完成：<br><code>删除主键索引:</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span>  table_name <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br></pre></td></tr></table></figure></p>
<p>主键索引的删除，如果没有<code>auto_increment</code> 属性则使用:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span>  表名 <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果在删除主键索引时，该字段中有<code>auto_increment</code>则先去掉该属性再删除。<br>去除主键的<code>auto_inrement</code>属性：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'主键'</span>;</span><br></pre></td></tr></table></figure></p>
<p>如有主键中有<code>auto_incrments</code>属性时，删除主键索引，则报如图提示。<br><img src="/img/WechatIMG26.jpeg" alt=""></p>
<p>去除主键中的<code>auto_increment</code>属性再删除主键索引：<br><img src="/img/WechatIMG27.jpeg" alt=""></p>
<p><code>删除其他索引:</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名  <span class="keyword">drop</span> <span class="keyword">index</span> 索引名字;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG28.jpeg" alt=""></p>
<h4 id="索引注意事项"><a href="#索引注意事项" class="headerlink" title="索引注意事项"></a>索引注意事项</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">第一：较频繁的作为查询条件字段应该创建索引</span><br><span class="line">select * from emp where empno = 1</span><br><span class="line">第二：唯一性太差的字段不适合单独创建索引，即使频繁作为查询条件</span><br><span class="line">	select * from emp where sex = &apos;男‘</span><br><span class="line">第三：更新非常频繁的字段不适合创建索引</span><br><span class="line">	select * from emp where logincount = 1</span><br><span class="line">第四：不会出现在WHERE子句中字段不该创建索</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">### 索引的执行计划</span><br><span class="line">```text</span><br><span class="line">语法：explain  sql语句\G   或 desc sql语句\G</span><br></pre></td></tr></table></figure>
<p>一个<code>sql</code>语句在没有执行(运行)之前，先计算一下该<code>sql</code>语句需要调用的相关资源，再决定该<code>sql</code>语句是否要最终执行，该行为被称为“执行计划”。<br>主要用于分析<code>sql</code>语句的执行情况（并不执行<code>sql</code>语句）得到<code>sql</code>语句是否使用了索引，使用了哪些索引</p>
<p>添加索引查看执行计划<br><img src="/img/WechatIMG29.jpeg" alt=""></p>
<p>删除索引时查看执行计划<br><img src="/img/WechatIMG30.jpeg" alt=""></p>
<h3 id="索引的数据结构"><a href="#索引的数据结构" class="headerlink" title="索引的数据结构"></a>索引的数据结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看索引的类型：</span><br><span class="line">show keys from 表名;</span><br></pre></td></tr></table></figure>
<p><img src="/img/WechatIMG31.jpeg" alt=""></p>
<h4 id="MyiSam的存储引擎索引结构"><a href="#MyiSam的存储引擎索引结构" class="headerlink" title="MyiSam的存储引擎索引结构"></a><code>MyiSam</code>的存储引擎索引结构</h4><p>索引的节点中存储的是数据的物理地址（磁道和扇区）和 关键字内容<br>在查找数据时，查找到索引后，根据索引节点中记录的物理地址，查找到具体的数据内容。<br><img src="/img/WechatIMG32.jpeg" alt=""></p>
<h4 id="InnoDb的存储引擎的索引结构"><a href="#InnoDb的存储引擎的索引结构" class="headerlink" title="InnoDb的存储引擎的索引结构"></a><code>InnoDb</code>的存储引擎的索引结构</h4><p><code>innodb</code>的主键索引文件上 直接存放该行数据,称为聚簇索引,非主索引指向对主键的引用（非主键索引的节点存储是主键的<code>id</code>）<br><img src="/img/WechatIMG33.jpeg" alt=""></p>
<p>比如要通过<code>nam</code>创建的索引，查询<code>name=’李莫愁’</code>的,先根据<code>name</code>建立的索引，找出该条记录的主键<code>id</code>，再根据主键的<code>id</code>通过主键索引找出该条记录。</p>
<p><code>innodb</code>的主索引文件上 直接存放该行数据,称为聚簇索引,非主索引指向对主键的引用<br><code>myisam</code>中, 主索引和非主索引,都指向物理行(磁盘位置).<br>注意: <code>innodb</code>来说,<br>1: 主键索引 既存储索引值,又在叶子中存储行的数据<br>2: 如果没有主键, 则会<code>Unique key</code>做主键<br>3: 如果没有<code>unique</code>,则系统生成一个内部的<code>rowid</code>做主键.<br>4: 像<code>innodb</code>中,主键的索引结构中,既存储了主键值,又存储了行数据,这种结构称为”聚簇索引”<br>聚簇索引<br>优势: 根据主键查询条目比较少时,不用回行(数据就在主键节点下)<br>劣势: 如果碰到不规则数据插入时,造成频繁的页分裂.</p>
<h3 id="索引覆盖"><a href="#索引覆盖" class="headerlink" title="索引覆盖"></a>索引覆盖</h3><p>索引覆盖是指：如果查询的列恰好是索引的一部分，那么查询只需要在索引区上进行，<br>不需要到数据区再找数据，这种查询速度非常快，称为“索引覆盖”。</p>
<p>查询字段 和 索引字段 完全一致时，或者 是索引字段一部分时！</p>
<p>我们先分析一下使用场景，为什么使用索引覆盖，有什么好处？<br>案例1，比如给<code>id</code>建立了主键索引，使用<code>id</code>查询数据。<br><img src="/img/WechatIMG34.jpeg" alt=""></p>
<p>在<code>t6</code>表里面，给<code>name</code>字段添加索引，查询<code>name</code>,就用到了索引覆盖。<br><img src="/img/WechatIMG35.jpeg" alt=""></p>
<p>案例2：比如给<code>id</code>和<code>name</code> 建立了复合索引，使用<code>name</code>作为条件查询。<br>没有创建索引时<br><img src="/img/WechatIMG36.jpeg" alt=""></p>
<p>给<code>id</code>和<code>name</code>创建复合索引<br><img src="/img/WechatIMG37.jpeg" alt=""></p>
<p>典型情况如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">学生表：</span><br><span class="line">共30个字段。</span><br><span class="line">Select id, name, height,gender from student where name=’XXX’;</span><br><span class="line">建立索引：</span><br><span class="line">Alter table student add index (name);</span><br><span class="line">Alter table student add index (name, id, height, gender, class_id);</span><br><span class="line">负面影响，增加了索引的尺寸（索引文件变大）。</span><br><span class="line">保证该索引的使用率尽可能高，索引覆盖才有意义。</span><br></pre></td></tr></table></figure></p>
<h3 id="索引的使用原则"><a href="#索引的使用原则" class="headerlink" title="索引的使用原则"></a>索引的使用原则</h3><h4 id="列独立"><a href="#列独立" class="headerlink" title="列独立"></a>列独立</h4><p>只有参与条件表达式的字段独立在关系运算符的一侧，该字段才可能使用到索引。<br>“独立的列”是指索引列不能是表达式的一部分，也不能是函数的参数。<br><img src="/img/WechatIMG38.jpeg" alt=""><br><img src="/img/WechatIMG39.jpeg" alt=""><br><img src="/img/WechatIMG40.jpeg" alt=""></p>
<h4 id="Like查询"><a href="#Like查询" class="headerlink" title="Like查询"></a><code>Like</code>查询</h4><p>在使用<code>like</code>(模糊匹配)的时候，在左边没有通配符的情况下，才可以使用索引。<br>在<code>mysql</code>里，以%开头的<code>like</code>查询，用不到索引<br><img src="/img/WechatIMG41.jpeg" alt=""><br><img src="/img/WechatIMG42.jpeg" alt=""><br>注意，如果select的字段正好就是索引，那么会用到索引即索引覆盖。<br><img src="/img/WechatIMG43.jpeg" alt=""></p>
<p>索引覆盖就是，我要在书里 查找一个内容，由于目录写的很详细，我在目录中就获取到了，不需要再翻到该页查看。<br>如果该表改为<code>innodb</code>引擎，因为非主键索引中存储的是<code>id,select</code>的字段是<code>id</code>因此用到了索引覆盖<br><img src="/img/WechatIMG44.jpeg" alt=""><br><img src="/img/WechatIMG45.jpeg" alt=""><br>如果是<code>innodb</code>的表，可以如上使用</p>
<h4 id="OR或-运算"><a href="#OR或-运算" class="headerlink" title="OR或 运算"></a><code>OR</code>或 运算</h4><p>如果出现<code>OR</code>(或者)运算，要求所有参与运算的字段都存在索引，才会使用到索引。<br>如下：<code>id</code>有索引，<code>classid</code>没有索引<br><img src="/img/WechatIMG46.jpeg" alt=""><br>如下：id有索引，name有索引<br><img src="/img/WechatIMG47.jpeg" alt=""></p>
<h4 id="复合索引使用"><a href="#复合索引使用" class="headerlink" title="复合索引使用"></a>复合索引使用</h4><p>对于创建的多列(复合)索引，只要查询条件使用了最左边的列，索引一般就会被使用。<br>使用<code>name</code>作为查询条件<br><img src="/img/WechatIMG48.jpeg" alt=""><br><img src="/img/WechatIMG49.jpeg" alt=""><br>使用<code>age</code>作为查询条件：<br><img src="/img/WechatIMG50.jpeg" alt=""><br>所以，在创建复合索引时，要根据业务需求，<code>where</code>子句中使用最频繁的一列放在最左边。</p>
<h4 id="MySql智能选择"><a href="#MySql智能选择" class="headerlink" title="MySql智能选择"></a><code>MySql</code>智能选择</h4><p>如果<code>mysql</code>认为，全表扫描不会慢于使用索引，则<code>mysql</code>会选择放弃索引，直接使用全表扫描。一般当取出的数据量超过表中数据的<code>20%</code>，<br>优化器就不会使用索引，而是全表扫描。<br><img src="/img/WechatIMG51.jpeg" alt=""><br><img src="/img/WechatIMG52.jpeg" alt=""><br>所以，满足了语法规则，索引不一定能使用！<br><img src="/img/WechatIMG53.jpeg" alt=""></p>
<h4 id="优化Group-By语句"><a href="#优化Group-By语句" class="headerlink" title="优化Group By语句"></a>优化<code>Group By</code>语句</h4><p>默认情况下， <code>mysql</code>对所有的<code>group by col1,col2</code>进行排序。这与在查询中指定<code>order by col1,col2</code>类型，如果查询中包括<code>group by</code> 但用户想要避免排序结果的消耗，则可以使用<code>order by null</code>禁止排序。<br>输出班级的<code>id,classid</code><br><img src="/img/WechatIMG54.jpeg" alt=""><br>根据<code>classid</code>分组，自动根据<code>classid</code>进行 了排序，<br><img src="/img/WechatIMG55.jpeg" alt=""><br>如果不想根据<code>classid</code>排序，则可以在后面使用<code>order by nulll</code><br><img src="/img/WechatIMG56.jpeg" alt=""><br>通过分析语句发现:<br><img src="/img/WechatIMG57.jpeg" alt=""><br><img src="/img/WechatIMG58.jpeg" alt=""></p>
<h2 id="数据碎片与维护"><a href="#数据碎片与维护" class="headerlink" title="数据碎片与维护"></a>数据碎片与维护</h2><p>数据碎片：<br>当删除了数据表中的一条记录时，该记录占用对的空间会被留空，如果经常插入数据和删除数据，则会产生很多不连续的碎片，这样久而久之，<br>这个表就会占用很大空间，但实际上表里面的记录数却很少，这样不但会浪费空间，而且查询速度也更慢。<br>在长期的数据更改过程中，索引文件和数据文件，都将产生空洞，形成碎片，我们可以通过一个操作（不产生对数据实质影响的操作）来修改表，<br>例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">创建一个表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t7(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span></span><br><span class="line">)<span class="keyword">engine</span> myisam;</span><br><span class="line">自我复制添加数据</span><br><span class="line">注：如果忘记命令，请到我的上篇文章去找</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG78.jpeg" alt=""><br><img src="/img/WechatIMG79.jpeg" alt=""><br>删除了一部分数据，应该表的容量会减少一部分，但是没有减掉，<br><img src="/img/WechatIMG80.jpeg" alt=""><br><img src="/img/WechatIMG81.jpeg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开始整理：</span><br><span class="line">optimize table 表名</span><br></pre></td></tr></table></figure>
<p><img src="/img/WechatIMG82.jpeg" alt=""><br>整理后的结果，容量减少了一部分<br><img src="/img/WechatIMG83.jpeg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">比如：表的引擎为innodb,可以alter table xxx engine innodb </span><br><span class="line">optimize table 表名，也可以修复</span><br></pre></td></tr></table></figure>
<p>注意：修复表的数据及索引碎片，就会把所有的数据文件重新整理一遍，使之对齐，这个过程，如果表的行数比较大，也是比较耗费资源的操作，所以，不能频繁的修复。<br>如果表的<code>update，delete</code>操作很频繁，可以按周月来修复。</p>
<p>如何查看数据表的碎片空间有多大？<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> 表名\G;  </span><br><span class="line">“data_free”一项显示了表的留空空间。</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/WechatIMG84.jpeg" alt=""></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/分区/" rel="tag"># 分区</a>
          
            <a href="/tags/分表/" rel="tag"># 分表</a>
          
            <a href="/tags/SQL优化/" rel="tag"># SQL优化</a>
          
            <a href="/tags/索引/" rel="tag"># 索引</a>
          
            <a href="/tags/三范式/" rel="tag"># 三范式</a>
          
            <a href="/tags/索引的执行计划/" rel="tag"># 索引的执行计划</a>
          
            <a href="/tags/索引的数据结构/" rel="tag"># 索引的数据结构</a>
          
            <a href="/tags/索引覆盖/" rel="tag"># 索引覆盖</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/MySql优化三部曲之存储层优化.html" rel="next" title="MySql优化三部曲之存储层优化">
                <i class="fa fa-chevron-left"></i> MySql优化三部曲之存储层优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/MySql优化三部曲之设计层优化(下).html" rel="prev" title="MySql优化三部曲之设计层优化(下)">
                MySql优化三部曲之设计层优化(下) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer" target="_blank">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/img/dog.jpeg" alt="Gzl">
            
              <p class="site-author-name" itemprop="name">Gzl</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#设计层"><span class="nav-number">1.</span> <span class="nav-text">设计层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三范式"><span class="nav-number">2.</span> <span class="nav-text">三范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一范式"><span class="nav-number">2.1.</span> <span class="nav-text">第一范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二范式"><span class="nav-number">2.2.</span> <span class="nav-text">第二范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三范式"><span class="nav-number">2.3.</span> <span class="nav-text">第三范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反三范式"><span class="nav-number">2.4.</span> <span class="nav-text">反三范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询需要优化的语句"><span class="nav-number">2.5.</span> <span class="nav-text">查询需要优化的语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#修改配置启动MySql慢查询日志"><span class="nav-number">2.5.1.</span> <span class="nav-text">修改配置启动MySql慢查询日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#直接命令开启MySql慢查询日志"><span class="nav-number">2.5.2.</span> <span class="nav-text">直接命令开启MySql慢查询日志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#精确记录查询时间"><span class="nav-number">2.6.</span> <span class="nav-text">精确记录查询时间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引"><span class="nav-number">3.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的管理方法"><span class="nav-number">3.1.</span> <span class="nav-text">索引的管理方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建索引"><span class="nav-number">3.1.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看索引"><span class="nav-number">3.1.2.</span> <span class="nav-text">查看索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除索引"><span class="nav-number">3.1.3.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引注意事项"><span class="nav-number">3.1.4.</span> <span class="nav-text">索引注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的数据结构"><span class="nav-number">3.2.</span> <span class="nav-text">索引的数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MyiSam的存储引擎索引结构"><span class="nav-number">3.2.1.</span> <span class="nav-text">MyiSam的存储引擎索引结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDb的存储引擎的索引结构"><span class="nav-number">3.2.2.</span> <span class="nav-text">InnoDb的存储引擎的索引结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引覆盖"><span class="nav-number">3.3.</span> <span class="nav-text">索引覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的使用原则"><span class="nav-number">3.4.</span> <span class="nav-text">索引的使用原则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#列独立"><span class="nav-number">3.4.1.</span> <span class="nav-text">列独立</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Like查询"><span class="nav-number">3.4.2.</span> <span class="nav-text">Like查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OR或-运算"><span class="nav-number">3.4.3.</span> <span class="nav-text">OR或 运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复合索引使用"><span class="nav-number">3.4.4.</span> <span class="nav-text">复合索引使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySql智能选择"><span class="nav-number">3.4.5.</span> <span class="nav-text">MySql智能选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优化Group-By语句"><span class="nav-number">3.4.6.</span> <span class="nav-text">优化Group By语句</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据碎片与维护"><span class="nav-number">4.</span> <span class="nav-text">数据碎片与维护</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gzl</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="http://hexo.io" rel="external nofollow noopener noreferrer">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow noopener noreferrer">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://disqus_k0AAUxAZIe.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https:blog.guozhenlei.top/MySql优化三部曲之设计层优化(上).html';
          this.page.identifier = 'MySql优化三部曲之设计层优化(上).html';
          this.page.title = 'MySql优化三部曲之设计层优化(上)';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://disqus_k0AAUxAZIe.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
